{% extends 'layout.html' %}

{% load static %}

{% block head %}
    <title>Book | Flight</title>
    <link rel="stylesheet" href="{% static 'css/book_style.css' %}">
<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">-->
    <script type="text/javascript" src="{% static 'js/book.js' %}"></script>
{% endblock %}

{% block body %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    <section class="section section1">
        <form action="{% url 'book' %}" onsubmit="return book_submit()" method="POST">
            {% csrf_token %}
            <input type="hidden" name="tripType" value='{{tripType}}' id="tripType">
             <input type="hidden" name="people" value="{{people}}" id="people">
            {% if tripType == '1' %}
                 <input type="hidden" name="stop" value='{{stop}}' id="stop">
                <input type="hidden" name="seat" value="{{seat}}">
                {% if stop == 'yes' %}
                    <input type="hidden" name="flight.0.id" value='{{flight0.id}}'>
                    <input type="hidden" name="flight.1.id" value='{{flight1.id}}'>
                    {% if flight1Date is None and flight0Date is None %}
                        <input type="hidden" name="flight.0.date" value='{{flight0ddate | date:"d-m-Y"}}'>
                        <input type="hidden" name="flight.1.date" value='{{flight1ddate | date:"d-m-Y"}}'>
                    {% else %}
                         <input type="hidden" name="flight.0.date" value='{{flight0Date}}'>
                         <input type="hidden" name="flight.1.date" value='{{flight1Date}}'>
                    {% endif%}
                {% endif %}
                {% if stop == 'no' %}
                    {% if flight1Date %}
                        <input type="hidden" name="flight1Date" value='{{flight1Date}}'>
                    {% else %}
                        <input type="hidden" name="flight1Date" value='{{flight1ddate | date:"d-m-Y"}}'>
                    {% endif%}
                        <input type="hidden" name="flight1" value="{{flight1.id}}">
                        <input type="hidden" name="flight1Class" value="{{seat}}">
                {% endif %}
            {% endif %}
            {% if tripType == '2' %}
                 <input type="hidden" name="stop1" value='{{stop1}}' id="stop1">
                 <input type="hidden" name="seat" value="{{seat}}">
                {% if stop1 == 'yes' %}
                    <input type="hidden" name="flight.0.id" value='{{flight0.id}}'>
                    <input type="hidden" name="flight.1.id" value='{{flight1.id}}'>
                    {% if flight1Date is None and flight0Date is None %}
                       <input type="hidden" name="flight.0.date" value='{{flight0ddate | date:"d-m-Y"}}'>
                        <input type="hidden" name="flight.1.date" value='{{flight1ddate | date:"d-m-Y"}}'>
                    {% else %}
                         <input type="hidden" name="flight.0.date" value='{{flight0Date}}'>
                        <input type="hidden" name="flight.1.date" value='{{flight1Date}}'>
                    {% endif%}
                {% endif %}
                {% if stop1 == 'no' %}
                   {% if flight1Date %}
                        <input type="hidden" name="flight1Date" value='{{flight1Date}}'>
                    {% else %}
                        <input type="hidden" name="flight1Date" value='{{flight1ddate | date:"d-m-Y"}}'>
                    {% endif%}
                        <input type="hidden" name="seat" value="{{seat}}">
                        <input type="hidden" name="flight1" value="{{flight1.id}}">
                        <input type="hidden" name="flight1Class" value="{{seat}}">
                {% endif %}
                <input type="hidden" name="stop2" value='{{stop2}}' id="stop2">
                <input type="hidden" name="seat" value="{{seat}}">
                {% if stop2 == 'yes' %}
                    <input type="hidden" name="flight.2.id" value='{{flight2.id}}'>
                    <input type="hidden" name="flight.3.id" value='{{flight3.id}}'>
                    {% if flight2Date is None and flight3Date is None %}
                        <input type="hidden" name="flight.2.date" value='{{flight2ddate | date:"d-m-Y"}}'>
                        <input type="hidden" name="flight.3.date" value='{{flight3ddate | date:"d-m-Y"}}'>
                    {% else %}
                        <input type="hidden" name="flight.2.date" value='{{flight2Date}}'>
                        <input type="hidden" name="flight.3.date" value='{{flight3Date}}'>
                    {% endif%}
                {% endif %}
                {% if stop2 == 'no' %}
                    <input type="hidden" name="flight2" value="{{flight2.id}}">
                    <input type="hidden" name="flight2Class" value="{{seat}}">
                    {% if flight2Date %}
                        <input type="hidden" name="flight2Date" value='{{flight2Date}}'>
                    {% else %}
                        <input type="hidden" name="flight2Date" value='{{flight2ddate | date:"d-m-Y"}}'>
                    {% endif%}
                {% endif %}
            {% endif %}
            <div class="row main-row">
                <div class="col-8">
                <div class="ticket-details">
            {% if tripType == '1'%}
                    <h5>Flight Details</h5>
                    <hr>
                {% if stop == 'yes' %}
                    <div class="media-airline">
                            <div>
                                <div class="brand">{{flight0.airline}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{flight0.plane}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{seat}}</div>
                            </div>
                        </div>
                        <div class="row ticket-details-div">
                        <div class="col-3 airline-name">
                            <div class="brand">{{flight0.airline}}</div>
                            <div class="plane-name">{{flight0.plane}}</div>
                        </div>
                        <div class="col-3 depart-time">
                            <div class="time">{{flight0.depart_time | time:'H:i'}}</div>
                            <div class="date ddate" data-value='{{flight0ddate | date:"d-m-Y"}}'>{{flight0ddate | date:"D, d M y"}}</div>
                            <div class="place">{{flight0.origin.city}}</div>
                            <div class="airport">{{flight0.origin.airport}}</div>
                        </div>
                        <div class="col-3 time-details">
                            <div class="duration" data-value="{{flight0.duration}}"></div>
                        </div>
                        <div class="col-3 arrival-time">
                            <div class="time">{{flight0.arrival_time | time:'H:i'}}</div>
                            <div class="date adate" data-value='{{flight0adate | date:"d-m-Y"}}'>{{flight0adate | date:"D, d M y"}}</div>
                            <div class="place">{{flight0.destination.city}}</div>
                            <div class="airport">{{flight0.destination.airport}}</div>
                        </div>
                    </div>
                    <div class="media-airline">
                            <div>
                                <div class="brand">{{flight1.airline}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{flight1.plane}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{seat}}</div>
                            </div>
                        </div>
                    <div class="row ticket-details-div">
                        <div class="col-3 airline-name">
                            <div class="brand">{{flight1.airline}}</div>
                            <div class="plane-name">{{flight1.plane}}</div>
                        </div>
                        <div class="col-3 depart-time">
                            <div class="time">{{flight1.depart_time | time:'H:i'}}</div>
                            <div class="date ddate" data-value='{{flight1ddate | date:"d-m-Y"}}'>{{flight1ddate | date:"D, d M y"}}</div>
                            <div class="place">{{flight1.origin.city}}</div>
                            <div class="airport">{{flight1.origin.airport}}</div>
                        </div>
                        <div class="col-3 time-details">
                            <div class="duration" data-value="{{flight1.duration}}"></div>
                        </div>
                        <div class="col-3 arrival-time">
                            <div class="time">{{flight1.arrival_time | time:'H:i'}}</div>
                            <div class="date adate" data-value='{{flight1adate | date:"d-m-Y"}}'>{{flight1adate | date:"D, d M y"}}</div>
                            <div class="place">{{flight1.destination.city}}</div>
                            <div class="airport">{{flight1.destination.airport}}</div>
                        </div>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-primary btn-danger" data-toggle="modal" data-target="#myModal">
                            Buy Seat
                        </button>
                    </div>
                {% endif %}
                {% if stop == 'no' %}
                        <!--Round Trip-->
                        <div style="padding: 0 15px;" class="round-seperator"><hr style="border-top: 0.5px dashed rgba(0,0,0,.1);"></div>
                        <!--/Round Trip-->
                        <div class="media-airline">
                            <div>
                                <div class="brand">{{flight1.airline}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{flight1.plane}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{seat}}</div>
                            </div>
                        </div>
                        <div class="row ticket-details-div">
                            <div class="col-3 airline-name">
                                <div class="brand">{{flight1.airline}}</div>
                                <div class="plane-name">{{flight1.plane}}</div>
                            </div>
                            <div class="col-3 depart-time">
                                <div class="time">{{flight1.depart_time | time:'H:i'}}</div>
                                <div class="date ddate">{{flight1ddate | date:"D, d M y"}}</div>
                                <div class="place">{{flight1.origin.city}}</div>
                                <div class="airport">{{flight1.origin.airport}}</div>
                            </div>
                            <div class="col-3 time-details">
                                <div class="duration" data-value="{{flight1.duration}}"></div>
                            </div>
                            <div class="col-3 arrival-time">
                                <div class="time">{{flight1.arrival_time | time:'H:i'}}</div>
                                <div class="date adate">{{flight1adate | date:"D, d M y"}}</div>
                                <div class="place">{{flight1.destination.city}}</div>
                                <div class="airport">{{flight1.destination.airport}}</div>
                            </div>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-primary btn-danger" data-toggle="modal" data-target="#myModal">
                                Buy Seat
                            </button>
                        </div>
                {% endif %}
            {% endif %}
            {% if tripType == '2'%}
                {% if stop1 == 'yes' %}
                    <h5>Flight 1 Details</h5>
                    <hr>
                    <div class="media-airline">
                            <div>
                                <div class="brand">{{flight0.airline}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{flight0.plane}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{seat}}</div>
                            </div>
                        </div>
                        <div class="row ticket-details-div">
                        <div class="col-3 airline-name">
                            <div class="brand">{{flight0.airline}}</div>
                            <div class="plane-name">{{flight0.plane}}</div>
                        </div>
                        <div class="col-3 depart-time">
                            <div class="time">{{flight0.depart_time | time:'H:i'}}</div>
                            <div class="date ddate" data-value='{{flight0ddate | date:"d-m-Y"}}'>{{flight0ddate | date:"D, d M y"}}</div>
                            <div class="place">{{flight0.origin.city}}</div>
                            <div class="airport">{{flight0.origin.airport}}</div>
                        </div>
                        <div class="col-3 time-details">
                            <div class="duration" data-value="{{flight0.duration}}"></div>
                        </div>
                        <div class="col-3 arrival-time">
                            <div class="time">{{flight0.arrival_time | time:'H:i'}}</div>
                            <div class="date adate" data-value='{{flight0adate | date:"d-m-Y"}}'>{{flight0adate | date:"D, d M y"}}</div>
                            <div class="place">{{flight0.destination.city}}</div>
                            <div class="airport">{{flight0.destination.airport}}</div>
                        </div>
                    </div>
                    <div class="media-airline">
                            <div>
                                <div class="brand">{{flight1.airline}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{flight1.plane}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{seat}}</div>
                            </div>
                        </div>
                    <div class="row ticket-details-div">
                        <div class="col-3 airline-name">
                            <div class="brand">{{flight1.airline}}</div>
                            <div class="plane-name">{{flight1.plane}}</div>
                        </div>
                        <div class="col-3 depart-time">
                            <div class="time">{{flight1.depart_time | time:'H:i'}}</div>
                            <div class="date ddate" data-value='{{flight1ddate | date:"d-m-Y"}}'>{{flight1ddate | date:"D, d M y"}}</div>
                            <div class="place">{{flight1.origin.city}}</div>
                            <div class="airport">{{flight1.origin.airport}}</div>
                        </div>
                        <div class="col-3 time-details">
                            <div class="duration" data-value="{{flight1.duration}}"></div>
                        </div>
                        <div class="col-3 arrival-time">
                            <div class="time">{{flight1.arrival_time | time:'H:i'}}</div>
                            <div class="date adate" data-value='{{flight1adate | date:"d-m-Y"}}'>{{flight1adate | date:"D, d M y"}}</div>
                            <div class="place">{{flight1.destination.city}}</div>
                            <div class="airport">{{flight1.destination.airport}}</div>
                        </div>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-primary btn-danger" data-toggle="modal" data-target="#myModal">
                            Buy Seat
                        </button>
                    </div>
                    {% endif%}
                    {% if stop2 == 'yes' %}

                        <h5>Flight 2 Details</h5>
                        <hr>
                        <div class="media-airline">
                            <div>
                                <div class="brand">{{ flight2.airline }}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{ flight2.plane }}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{ seat }}</div>
                            </div>
                        </div>
                        <div class="row ticket-details-div">
                            <div class="col-3 airline-name">
                                <div class="brand">{{ flight2.airline }}</div>
                                <div class="plane-name">{{ flight2.plane }}</div>
                            </div>
                            <div class="col-3 depart-time">
                                <div class="time">{{ flight2.depart_time | time:'H:i' }}</div>
                                <div class="date ddate" data-value="{{ flight2ddate | date:'d-m-Y' }}">{{ flight2ddate | date:'D, d M y' }}</div>
                                <div class="place">{{ flight2.origin.city }}</div>
                                <div class="airport">{{ flight2.origin.airport }}</div>
                            </div>
                            <div class="col-3 time-details">
                                <div class="duration" data-value="{{ flight2.duration }}"></div>
                            </div>
                            <div class="col-3 arrival-time">
                                <div class="time">{{ flight2.arrival_time | time:'H:i' }}</div>
                                <div class="date adate" data-value="{{ flight2adate | date:'d-m-Y' }}">{{ flight2adate | date:'D, d M y' }}</div>
                                <div class="place">{{ flight2.destination.city }}</div>
                                <div class="airport">{{ flight2.destination.airport }}</div>
                            </div>
                        </div>
                        <div class="media-airline">
                            <div>
                                <div class="brand">{{ flight3.airline }}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{ flight3.plane }}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{ seat }}</div>
                            </div>
                        </div>
                        <div class="row ticket-details-div">
                            <div class="col-3 airline-name">
                                <div class="brand">{{ flight3.airline }}</div>
                                <div class="plane-name">{{ flight3.plane }}</div>
                            </div>
                            <div class="col-3 depart-time">
                                <div class="time">{{ flight3.depart_time | time:'H:i' }}</div>
                                <div class="date ddate" data-value="{{ flight3ddate | date:'d-m-Y' }}">{{ flight3ddate | date:'D, d M y' }}</div>
                                <div class="place">{{ flight3.origin.city }}</div>
                                <div class="airport">{{ flight3.origin.airport }}</div>
                            </div>
                            <div class="col-3 time-details">
                                <div class="duration" data-value="{{ flight3.duration }}"></div>
                            </div>
                            <div class="col-3 arrival-time">
                                <div class="time">{{ flight3.arrival_time | time:'H:i' }}</div>
                                <div class="date adate" data-value="{{ flight3adate | date:'d-m-Y' }}">{{ flight3adate | date:'D, d M y' }}</div>
                                <div class="place">{{ flight3.destination.city }}</div>
                                <div class="airport">{{ flight3.destination.airport }}</div>
                            </div>
                        </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-primary btn-danger" data-toggle="modal" data-target="#myModal1">
                            Buy Seat
                        </button>
                    </div>
                    {% endif%}
                {% if stop1 == 'no' %}
                        <h5>Flight 1 Details</h5>
                        <hr>
                    <!--Round Trip-->
                        <div style="padding: 0 15px;" class="round-seperator"><hr style="border-top: 0.5px dashed rgba(0,0,0,.1);"></div>
                        <!--/Round Trip-->
                        <div class="media-airline">
                            <div>
                                <div class="brand">{{flight1.airline}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{flight1.plane}}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{seat}}</div>
                            </div>
                        </div>
                        <div class="row ticket-details-div">
                            <div class="col-3 airline-name">
                                <div class="brand">{{flight1.airline}}</div>
                                <div class="plane-name">{{flight1.plane}}</div>
                            </div>
                            <div class="col-3 depart-time">
                                <div class="time">{{flight1.depart_time | time:'H:i'}}</div>
                                <div class="date ddate">{{flight1ddate | date:"D, d M y"}}</div>
                                <div class="place">{{flight1.origin.city}}</div>
                                <div class="airport">{{flight1.origin.airport}}</div>
                            </div>
                            <div class="col-3 time-details">
                                <div class="duration" data-value="{{flight2.duration}}"></div>
                            </div>
                            <div class="col-3 arrival-time">
                                <div class="time">{{flight1.arrival_time | time:'H:i'}}</div>
                                <div class="date adate">{{flight1adate | date:"D, d M y"}}</div>
                                <div class="place">{{flight1.destination.city}}</div>
                                <div class="airport">{{flight1.destination.airport}}</div>
                            </div>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-primary btn-danger" data-toggle="modal" data-target="#myModal">
                                Buy Seat
                            </button>
                        </div>
                    {% endif%}
                    {% if stop2 == 'no' %}

                        <h5>Flight 2 Details</h5>
                        <hr>
                        <div style="padding: 0 15px;" class="round-seperator">
                            <hr style="border-top: 0.5px dashed rgba(0,0,0,.1);">
                        </div>
                        <div class="media-airline">
                            <div>
                                <div class="brand">{{ flight2.airline }}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{ flight2.plane }}</div>
                                <div>&nbsp;&middot;&nbsp;</div>
                                <div class="plane-name">{{ seat }}</div>
                            </div>
                        </div>
                        <div class="row ticket-details-div">
                            <div class="col-3 airline-name">
                                <div class="brand">{{ flight2.airline }}</div>
                                <div class="plane-name">{{ flight2.plane }}</div>
                            </div>
                            <div class="col-3 depart-time">
                                <div class="time">{{ flight2.depart_time | time:'H:i' }}</div>
                                <div class="date ddate">{{ flight2ddate | date:"D, d M y" }}</div>
                                <div class="place">{{ flight2.origin.city }}</div>
                                <div class="airport">{{ flight2.origin.airport }}</div>
                            </div>
                            <div class="col-3 time-details">
                                <div class="duration" data-value="{{ flight2.duration }}"></div>
                            </div>
                            <div class="col-3 arrival-time">
                                <div class="time">{{ flight2.arrival_time | time:'H:i' }}</div>
                                <div class="date adate">{{ flight2adate | date:"D, d M y" }}</div>
                                <div class="place">{{ flight2.destination.city }}</div>
                                <div class="airport">{{ flight2.destination.airport }}</div>
                            </div>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-primary btn-danger" data-toggle="modal" data-target="#myModal1">
                                Buy Seat
                            </button>
                        </div>
                    {% endif%}
                {% endif%}
                    <hr>
                   <div class="row">
                <!-- Baggage Details -->
                <div class="baggage-details col-8">
                    <svg width="1em" height="1.5em" viewBox="0 3 16 16" class="bi bi-bag" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M8 1a2.5 2.5 0 0 0-2.5 2.5V4h5v-.5A2.5 2.5 0 0 0 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5zM2 5v9a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V5H2z"/>
                    </svg>
                    30 Kgs Check-in, 7 Kgs Cabin
                </div>

</div>
  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h5 class="modal-title" id="myModalLabel">Flight Seat Map: Flight 1</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">
          <div class="container">
            <div class="row">
                <!-- Left Area: First Class -->
                <div class="col-4">
                    <div class="area-title">First</div>
                    <div class="area">
                        {% for seat in seats1 %}
                            {% if seat.type == 'first' %}
                                {% if seat.status == 'SELECTED'%}
                                    <div class="seat selected" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                {% else%}
                                    <div class="seat" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                {% endif%}
                                <input type="hidden"  value="{{seat.id}}">
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <!-- Center Area: Business Class -->
                <div class="col-4">
                    <div class="area-title">Business</div>
                    <div class="area">
                        {% for seat in seats1 %}
                            {% if seat.type == 'business' %}
                                {% if seat.status == 'SELECTED'%}
                                    <div class="seat selected" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                {% else%}
                                    <div class="seat" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                {% endif%}
                                <input type="hidden"  value="{{seat.id}}">
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <!-- Right Area: Economy Class -->
                <div class="col-4">
                    <div class="area-title">Economy</div>
                    <div class="area">
                        {% for seat in seats1 %}
                            {% if seat.type == 'economy' %}
                               {% if seat.status == 'SELECTED'%}
                                    <div class="seat selected" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                {% else%}
                                    <div class="seat" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                {% endif%}
                                <input type="hidden"  value="{{seat.id}}">
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                <div class="seat selected" style="background-color: #fdeec3;"></div> <span>Your seat</span>
              </div>
              <div class="legend-item">
                <div class="seat selected"></div> <span>Selected</span>
              </div>
              <div class="legend-item">
                <div class="seat selected" style="background-color: #DC4C64;"></div> <span>Available</span>
              </div>
            </div>
          </div>
        </div>
       <!-- Modal Footer -->
        <div class="modal-footer">
            <div id="seat-notification" class="notification">
                You can only choose once seat for all flights. Your selection is now final.
            </div>
             <div id="count-display" class="ms-auto">
                Money: <span id="count">0</span>
            </div>
            <button type="button" class="btn btn-danger" data-dismiss="modal" >Close</button>
        </div>
      </div>
    </div>
  </div>
                    {% if flight2 %}
                      <!-- Modal -->
  <div class="modal fade" id="myModal1" tabindex="-1" aria-labelledby="myModalLabel1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title" id="myModalLabel1">Flight Seat Map: Flight 2</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <!-- Left Area: First Class -->
                        <div class="col-4">
                            <div class="area-title">First</div>
                            <div class="area">
                                {% for seat in seats2 %}
                                    {% if seat.type == 'first' %}
                                        {% if seat.status == 'SELECTED'%}
                                            <div class="seat1 selected" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                        {% else %}
                                            <div class="seat1" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                        {% endif %}
                                        <input type="hidden"  value="{{seat.id}}">
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Center Area: Business Class -->
                        <div class="col-4">
                            <div class="area-title">Business</div>
                            <div class="area">
                                {% for seat in seats2 %}
                                    {% if seat.type == 'business' %}
                                        {% if seat.status == 'SELECTED'%}
                                            <div class="seat1 selected" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                        {% else %}
                                            <div class="seat1" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                        {% endif %}
                                        <input type="hidden"  value="{{seat.id}}">
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Right Area: Economy Class -->
                        <div class="col-4">
                            <div class="area-title">Economy</div>
                            <div class="area">
                                {% for seat in seats2 %}
                                    {% if seat.type == 'economy' %}
                                       {% if seat.status == 'SELECTED'%}
                                            <div class="seat1 selected" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                        {% else %}
                                            <div class="seat1" value="{{ seat.price }}">{{ seat.seat_name }}</div>
                                        {% endif %}
                                        <input type="hidden"  value="{{seat.id}}">
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <!-- Legend -->
                    <div class="legend">
                        <div class="legend-item">
                            <div class="seat1 selected" style="background-color: #fdeec3;"></div> <span>Your seat</span>
                        </div>
                        <div class="legend-item">
                            <div class="seat1 selected"></div> <span>Selected</span>
                        </div>
                        <div class="legend-item">
                            <div class="seat1 selected" style="background-color: #DC4C64;"></div> <span>Available</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <div id="seat-notification1" class="notification">
                    You can only choose one seat for all flights. Your selection is now final.
                </div>
                <div id="count-display1" class="ms-auto">
                    Money: <span id="count1">0</span>
                </div>

                <!-- Hidden input container for selected seats -->
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

                    {% endif%}
                </div>
                <div class="traveller-details">
                    <div class="traveller-head">
                        <h5>Contact Information</h5>
                    </div>
                    <hr>
                    
                    <div class="row contact-details-div">
                        <div class="row form-group">
                            <!--<div class="input-group col">
                                <div class="input-group-prepend">
                                    
                                </div>
                            </div>-->
                            <div class="col-3 ci">
                                Country Code
                                <select name="countryCode" class="custom-select">
                                    <option data-countryCode="IN" value="91">India (+91)</option>
                                    <option data-countryCode="DZ" value="213">Algeria (+213)</option>
                                    <option data-countryCode="AD" value="376">Andorra (+376)</option>
                                    <option data-countryCode="AO" value="244">Angola (+244)</option>
                                    <option data-countryCode="AI" value="1264">Anguilla (+1264)</option>
                                    <option data-countryCode="AG" value="1268">Antigua &amp; Barbuda (+1268)</option>
                                    <option data-countryCode="AR" value="54">Argentina (+54)</option>
                                    <option data-countryCode="AM" value="374">Armenia (+374)</option>
                                    <option data-countryCode="AW" value="297">Aruba (+297)</option>
                                    <option data-countryCode="AU" value="61">Australia (+61)</option>
                                    <option data-countryCode="AT" value="43">Austria (+43)</option>
                                    <option data-countryCode="AZ" value="994">Azerbaijan (+994)</option>
                                    <option data-countryCode="BS" value="1242">Bahamas (+1242)</option>
                                    <option data-countryCode="BH" value="973">Bahrain (+973)</option>
                                    <option data-countryCode="BD" value="880">Bangladesh (+880)</option>
                                    <option data-countryCode="BB" value="1246">Barbados (+1246)</option>
                                    <option data-countryCode="BY" value="375">Belarus (+375)</option>
                                    <option data-countryCode="BE" value="32">Belgium (+32)</option>
                                    <option data-countryCode="BZ" value="501">Belize (+501)</option>
                                    <option data-countryCode="BJ" value="229">Benin (+229)</option>
                                    <option data-countryCode="BM" value="1441">Bermuda (+1441)</option>
                                    <option data-countryCode="BT" value="975">Bhutan (+975)</option>
                                    <option data-countryCode="BO" value="591">Bolivia (+591)</option>
                                    <option data-countryCode="BA" value="387">Bosnia Herzegovina (+387)</option>
                                    <option data-countryCode="BW" value="267">Botswana (+267)</option>
                                    <option data-countryCode="BR" value="55">Brazil (+55)</option>
                                    <option data-countryCode="BN" value="673">Brunei (+673)</option>
                                    <option data-countryCode="BG" value="359">Bulgaria (+359)</option>
                                    <option data-countryCode="BF" value="226">Burkina Faso (+226)</option>
                                    <option data-countryCode="BI" value="257">Burundi (+257)</option>
                                    <option data-countryCode="KH" value="855">Cambodia (+855)</option>
                                    <option data-countryCode="CM" value="237">Cameroon (+237)</option>
                                    <option data-countryCode="CA" value="1">Canada (+1)</option>
                                    <option data-countryCode="CV" value="238">Cape Verde Islands (+238)</option>
                                    <option data-countryCode="KY" value="1345">Cayman Islands (+1345)</option>
                                    <option data-countryCode="CF" value="236">Central African Republic (+236)</option>
                                    <option data-countryCode="CL" value="56">Chile (+56)</option>
                                    <option data-countryCode="CN" value="86">China (+86)</option>
                                    <option data-countryCode="CO" value="57">Colombia (+57)</option>
                                    <option data-countryCode="KM" value="269">Comoros (+269)</option>
                                    <option data-countryCode="CG" value="242">Congo (+242)</option>
                                    <option data-countryCode="CK" value="682">Cook Islands (+682)</option>
                                    <option data-countryCode="CR" value="506">Costa Rica (+506)</option>
                                    <option data-countryCode="HR" value="385">Croatia (+385)</option>
                                    <option data-countryCode="CU" value="53">Cuba (+53)</option>
                                    <option data-countryCode="CY" value="90392">Cyprus North (+90392)</option>
                                    <option data-countryCode="CY" value="357">Cyprus South (+357)</option>
                                    <option data-countryCode="CZ" value="42">Czech Republic (+42)</option>
                                    <option data-countryCode="DK" value="45">Denmark (+45)</option>
                                    <option data-countryCode="DJ" value="253">Djibouti (+253)</option>
                                    <option data-countryCode="DM" value="1809">Dominica (+1809)</option>
                                    <option data-countryCode="DO" value="1809">Dominican Republic (+1809)</option>
                                    <option data-countryCode="EC" value="593">Ecuador (+593)</option>
                                    <option data-countryCode="EG" value="20">Egypt (+20)</option>
                                    <option data-countryCode="SV" value="503">El Salvador (+503)</option>
                                    <option data-countryCode="GQ" value="240">Equatorial Guinea (+240)</option>
                                    <option data-countryCode="ER" value="291">Eritrea (+291)</option>
                                    <option data-countryCode="EE" value="372">Estonia (+372)</option>
                                    <option data-countryCode="ET" value="251">Ethiopia (+251)</option>
                                    <option data-countryCode="FK" value="500">Falkland Islands (+500)</option>
                                    <option data-countryCode="FO" value="298">Faroe Islands (+298)</option>
                                    <option data-countryCode="FJ" value="679">Fiji (+679)</option>
                                    <option data-countryCode="FI" value="358">Finland (+358)</option>
                                    <option data-countryCode="FR" value="33">France (+33)</option>
                                    <option data-countryCode="GF" value="594">French Guiana (+594)</option>
                                    <option data-countryCode="PF" value="689">French Polynesia (+689)</option>
                                    <option data-countryCode="GA" value="241">Gabon (+241)</option>
                                    <option data-countryCode="GM" value="220">Gambia (+220)</option>
                                    <option data-countryCode="GE" value="7880">Georgia (+7880)</option>
                                    <option data-countryCode="DE" value="49">Germany (+49)</option>
                                    <option data-countryCode="GH" value="233">Ghana (+233)</option>
                                    <option data-countryCode="GI" value="350">Gibraltar (+350)</option>
                                    <option data-countryCode="GR" value="30">Greece (+30)</option>
                                    <option data-countryCode="GL" value="299">Greenland (+299)</option>
                                    <option data-countryCode="GD" value="1473">Grenada (+1473)</option>
                                    <option data-countryCode="GP" value="590">Guadeloupe (+590)</option>
                                    <option data-countryCode="GU" value="671">Guam (+671)</option>
                                    <option data-countryCode="GT" value="502">Guatemala (+502)</option>
                                    <option data-countryCode="GN" value="224">Guinea (+224)</option>
                                    <option data-countryCode="GW" value="245">Guinea - Bissau (+245)</option>
                                    <option data-countryCode="GY" value="592">Guyana (+592)</option>
                                    <option data-countryCode="HT" value="509">Haiti (+509)</option>
                                    <option data-countryCode="HN" value="504">Honduras (+504)</option>
                                    <option data-countryCode="HK" value="852">Hong Kong (+852)</option>
                                    <option data-countryCode="HU" value="36">Hungary (+36)</option>
                                    <option data-countryCode="IS" value="354">Iceland (+354)</option>
                                    <!-- <option data-countryCode="IN" value="91">India (+91)</option> -->
                                    <option data-countryCode="ID" value="62">Indonesia (+62)</option>
                                    <option data-countryCode="IR" value="98">Iran (+98)</option>
                                    <option data-countryCode="IQ" value="964">Iraq (+964)</option>
                                    <option data-countryCode="IE" value="353">Ireland (+353)</option>
                                    <option data-countryCode="IL" value="972">Israel (+972)</option>
                                    <option data-countryCode="IT" value="39">Italy (+39)</option>
                                    <option data-countryCode="JM" value="1876">Jamaica (+1876)</option>
                                    <option data-countryCode="JP" value="81">Japan (+81)</option>
                                    <option data-countryCode="JO" value="962">Jordan (+962)</option>
                                    <option data-countryCode="KZ" value="7">Kazakhstan (+7)</option>
                                    <option data-countryCode="KE" value="254">Kenya (+254)</option>
                                    <option data-countryCode="KI" value="686">Kiribati (+686)</option>
                                    <option data-countryCode="KP" value="850">Korea North (+850)</option>
                                    <option data-countryCode="KR" value="82">Korea South (+82)</option>
                                    <option data-countryCode="KW" value="965">Kuwait (+965)</option>
                                    <option data-countryCode="KG" value="996">Kyrgyzstan (+996)</option>
                                    <option data-countryCode="LA" value="856">Laos (+856)</option>
                                    <option data-countryCode="LV" value="371">Latvia (+371)</option>
                                    <option data-countryCode="LB" value="961">Lebanon (+961)</option>
                                    <option data-countryCode="LS" value="266">Lesotho (+266)</option>
                                    <option data-countryCode="LR" value="231">Liberia (+231)</option>
                                    <option data-countryCode="LY" value="218">Libya (+218)</option>
                                    <option data-countryCode="LI" value="417">Liechtenstein (+417)</option>
                                    <option data-countryCode="LT" value="370">Lithuania (+370)</option>
                                    <option data-countryCode="LU" value="352">Luxembourg (+352)</option>
                                    <option data-countryCode="MO" value="853">Macao (+853)</option>
                                    <option data-countryCode="MK" value="389">Macedonia (+389)</option>
                                    <option data-countryCode="MG" value="261">Madagascar (+261)</option>
                                    <option data-countryCode="MW" value="265">Malawi (+265)</option>
                                    <option data-countryCode="MY" value="60">Malaysia (+60)</option>
                                    <option data-countryCode="MV" value="960">Maldives (+960)</option>
                                    <option data-countryCode="ML" value="223">Mali (+223)</option>
                                    <option data-countryCode="MT" value="356">Malta (+356)</option>
                                    <option data-countryCode="MH" value="692">Marshall Islands (+692)</option>
                                    <option data-countryCode="MQ" value="596">Martinique (+596)</option>
                                    <option data-countryCode="MR" value="222">Mauritania (+222)</option>
                                    <option data-countryCode="YT" value="269">Mayotte (+269)</option>
                                    <option data-countryCode="MX" value="52">Mexico (+52)</option>
                                    <option data-countryCode="FM" value="691">Micronesia (+691)</option>
                                    <option data-countryCode="MD" value="373">Moldova (+373)</option>
                                    <option data-countryCode="MC" value="377">Monaco (+377)</option>
                                    <option data-countryCode="MN" value="976">Mongolia (+976)</option>
                                    <option data-countryCode="MS" value="1664">Montserrat (+1664)</option>
                                    <option data-countryCode="MA" value="212">Morocco (+212)</option>
                                    <option data-countryCode="MZ" value="258">Mozambique (+258)</option>
                                    <option data-countryCode="MN" value="95">Myanmar (+95)</option>
                                    <option data-countryCode="NA" value="264">Namibia (+264)</option>
                                    <option data-countryCode="NR" value="674">Nauru (+674)</option>
                                    <option data-countryCode="NP" value="977">Nepal (+977)</option>
                                    <option data-countryCode="NL" value="31">Netherlands (+31)</option>
                                    <option data-countryCode="NC" value="687">New Caledonia (+687)</option>
                                    <option data-countryCode="NZ" value="64">New Zealand (+64)</option>
                                    <option data-countryCode="NI" value="505">Nicaragua (+505)</option>
                                    <option data-countryCode="NE" value="227">Niger (+227)</option>
                                    <option data-countryCode="NG" value="234">Nigeria (+234)</option>
                                    <option data-countryCode="NU" value="683">Niue (+683)</option>
                                    <option data-countryCode="NF" value="672">Norfolk Islands (+672)</option>
                                    <option data-countryCode="NP" value="670">Northern Marianas (+670)</option>
                                    <option data-countryCode="NO" value="47">Norway (+47)</option>
                                    <option data-countryCode="OM" value="968">Oman (+968)</option>
                                    <option data-countryCode="PW" value="680">Palau (+680)</option>
                                    <option data-countryCode="PA" value="507">Panama (+507)</option>
                                    <option data-countryCode="PG" value="675">Papua New Guinea (+675)</option>
                                    <option data-countryCode="PY" value="595">Paraguay (+595)</option>
                                    <option data-countryCode="PE" value="51">Peru (+51)</option>
                                    <option data-countryCode="PH" value="63">Philippines (+63)</option>
                                    <option data-countryCode="PL" value="48">Poland (+48)</option>
                                    <option data-countryCode="PT" value="351">Portugal (+351)</option>
                                    <option data-countryCode="PR" value="1787">Puerto Rico (+1787)</option>
                                    <option data-countryCode="QA" value="974">Qatar (+974)</option>
                                    <option data-countryCode="RE" value="262">Reunion (+262)</option>
                                    <option data-countryCode="RO" value="40">Romania (+40)</option>
                                    <option data-countryCode="RU" value="7">Russia (+7)</option>
                                    <option data-countryCode="RW" value="250">Rwanda (+250)</option>
                                    <option data-countryCode="SM" value="378">San Marino (+378)</option>
                                    <option data-countryCode="ST" value="239">Sao Tome &amp; Principe (+239)</option>
                                    <option data-countryCode="SA" value="966">Saudi Arabia (+966)</option>
                                    <option data-countryCode="SN" value="221">Senegal (+221)</option>
                                    <option data-countryCode="CS" value="381">Serbia (+381)</option>
                                    <option data-countryCode="SC" value="248">Seychelles (+248)</option>
                                    <option data-countryCode="SL" value="232">Sierra Leone (+232)</option>
                                    <option data-countryCode="SG" value="65">Singapore (+65)</option>
                                    <option data-countryCode="SK" value="421">Slovak Republic (+421)</option>
                                    <option data-countryCode="SI" value="386">Slovenia (+386)</option>
                                    <option data-countryCode="SB" value="677">Solomon Islands (+677)</option>
                                    <option data-countryCode="SO" value="252">Somalia (+252)</option>
                                    <option data-countryCode="ZA" value="27">South Africa (+27)</option>
                                    <option data-countryCode="ES" value="34">Spain (+34)</option>
                                    <option data-countryCode="LK" value="94">Sri Lanka (+94)</option>
                                    <option data-countryCode="SH" value="290">St. Helena (+290)</option>
                                    <option data-countryCode="KN" value="1869">St. Kitts (+1869)</option>
                                    <option data-countryCode="SC" value="1758">St. Lucia (+1758)</option>
                                    <option data-countryCode="SD" value="249">Sudan (+249)</option>
                                    <option data-countryCode="SR" value="597">Suriname (+597)</option>
                                    <option data-countryCode="SZ" value="268">Swaziland (+268)</option>
                                    <option data-countryCode="SE" value="46">Sweden (+46)</option>
                                    <option data-countryCode="CH" value="41">Switzerland (+41)</option>
                                    <option data-countryCode="SI" value="963">Syria (+963)</option>
                                    <option data-countryCode="TW" value="886">Taiwan (+886)</option>
                                    <option data-countryCode="TJ" value="7">Tajikstan (+7)</option>
                                    <option data-countryCode="TH" value="66">Thailand (+66)</option>
                                    <option data-countryCode="TG" value="228">Togo (+228)</option>
                                    <option data-countryCode="TO" value="676">Tonga (+676)</option>
                                    <option data-countryCode="TT" value="1868">Trinidad &amp; Tobago (+1868)</option>
                                    <option data-countryCode="TN" value="216">Tunisia (+216)</option>
                                    <option data-countryCode="TR" value="90">Turkey (+90)</option>
                                    <option data-countryCode="TM" value="7">Turkmenistan (+7)</option>
                                    <option data-countryCode="TM" value="993">Turkmenistan (+993)</option>
                                    <option data-countryCode="TC" value="1649">Turks &amp; Caicos Islands (+1649)</option>
                                    <option data-countryCode="TV" value="688">Tuvalu (+688)</option>
                                    <option data-countryCode="UG" value="256">Uganda (+256)</option>
                                    <option data-countryCode="GB" value="44">UK (+44)</option>
                                    <option data-countryCode="UA" value="380">Ukraine (+380)</option>
                                    <option data-countryCode="AE" value="971">United Arab Emirates (+971)</option>
                                    <option data-countryCode="UY" value="598">Uruguay (+598)</option>
                                    <option data-countryCode="US" value="1">USA (+1)</option>
                                    <option data-countryCode="UZ" value="7">Uzbekistan (+7)</option>
                                    <option data-countryCode="VU" value="678">Vanuatu (+678)</option>
                                    <option data-countryCode="VA" value="379">Vatican City (+379)</option>
                                    <option data-countryCode="VE" value="58">Venezuela (+58)</option>
                                    <option data-countryCode="VN" value="84">Vietnam (+84)</option>
                                    <option data-countryCode="VG" value="84">Virgin Islands - British (+1284)</option>
                                    <option data-countryCode="VI" value="84">Virgin Islands - US (+1340)</option>
                                    <option data-countryCode="WF" value="681">Wallis &amp; Futuna (+681)</option>
                                    <option data-countryCode="YE" value="969">Yemen (North)(+969)</option>
                                    <option data-countryCode="YE" value="967">Yemen (South)(+967)</option>
                                    <option data-countryCode="ZM" value="260">Zambia (+260)</option>
                                    <option data-countryCode="ZW" value="263">Zimbabwe (+263)</option>
                                </select>
                            </div>
                            <div class="col-3 ci">
                                Mobile No
                                <input type="tel" pattern="[0-9]*" name="mobile" class="form-control" placeholder="Mobile No" required>
                            </div>
                            <div class="col-6 ci">
                                Email
                                <input type="email" name="email" class="form-control" placeholder="Email" required>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="send-email">
                        &nbsp;
                    </div>
                </div>

                <div class="traveller-details individual-traveller-div">
                    <div class="traveller-head">
                        <h5>Passenger Details</h5>
                        <h6><span>0</span> Passengers</h6>
                    </div>
                    <hr>
                    <input type="hidden" id="p-count" name="passengersCount" value="0">
                    <div class="each-traveller-div">
                    </div>
                    <div class="row each-traveller no-traveller">
                        <div>
                            <span class="traveller-name"></span>
                            You have not added any adults to the list
                        </div>
                    </div>
                    <div class="row add-traveller-div collapse" id="collapseExample">
                        <div class="note-name"><span>IMPORTANT :</span> Enter your name as it is mentioned on your passport or any government approved ID.</div>
                        <div class="row form-group add-traveller-div-name">
                            <div class="col">
                                <input type="text" class="form-control" id="fname" placeholder="First name">
                            </div>
                            <div class="col">
                                <input type="text" class="form-control" id="lname" placeholder="Last name">
                            </div>
                        </div>
                        
                        <div class="row form-group radio-div">
                            <div class="form-check-inline cd">
                                Gender: 
                            </div>
                            <div class="form-check-inline">
                                <label class="form-check-label">
                                    <input type="radio" class="form-check-input gender" name="gd" value="male">Male
                                </label>
                            </div>
                            <div class="form-check-inline">
                                <label class="form-check-label">
                                    <input type="radio" class="form-check-input gender" name="gd"  value="female">Female
                                </label>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary btn-light" style="margin-right: auto;" onclick="add_traveller()">Add</button>
                    </div>
                    <hr>
                    <div class="add-traveller">
                        <button class="add-traveller-btn text-uppercase btn"  type="button" data-toggle="collapse" data-target="#collapseExample">+ ADD ADULT</button>
                    </div>
                </div>
                <div class="payment-btn" style="background-color: transparent;">
                    <button type="submit" class="btn btn-primary btn-danger">Proceed to payment</button>
                </div>
                </div>
                <div class="col-4">
                    <div class="price-details">
                        <h5>Fare Summary</h5>
                        <hr>
                        <div class="row">
                            <div class="currency-switcher">
                                <label for="currency">Choose currency: </label>
                                <select id="currency" onchange="updateCurrency ()">
                                <option value="USD" selected>USD ($)</option>
                                <option value="VND">VND ()</option>
                                </select>
                            </div>
                        </div>
                        <hr>
                        <div class="row base-fare">
                            <div class="base-fae-label">Base Fare: </div>
                            <div class="base-fare-value">
                                {% if seat == 'First' %}
                                $ <span>
                                    {% if tripType == '1' %}
                                        {% if stop == 'yes' %}
                                            {{ flight0.first_fare | add:flight1.first_fare }}
                                        {% else %}
                                            {{ flight1.first_fare }}
                                        {% endif %}
                                    {% else %}
                                        {% if stop1 == 'yes' and stop2 == 'yes' %}
                                            {{ flight0.first_fare | add:flight1.first_fare | add:flight2.first_fare | add:flight3.first_fare }}
                                        {% elif stop1 == 'yes' and stop2 == 'no' %}
                                            {{ flight0.first_fare | add:flight1.first_fare | add:flight2.first_fare }}
                                        {% elif stop1 == 'no' and stop2 == 'yes' %}
                                            {{ flight3.first_fare | add:flight1.first_fare | add:flight2.first_fare }}
                                        {% else %}
                                            {{ flight1.first_fare | add:flight2.first_fare }}
                                        {% endif %}
                                    {% endif %}
                                </span>
                                <input type="hidden" id="basefare" value="
                                    {% if tripType == '1' %}
                                        {% if stop == 'yes' %}
                                            {{ flight0.first_fare | add:flight1.first_fare }}
                                        {% else %}
                                            {{ flight1.first_fare }}
                                        {% endif %}
                                    {% else %}
                                        {% if stop1 == 'yes' and stop2 == 'yes' %}
                                            {{ flight0.first_fare | add:flight1.first_fare | add:flight2.first_fare | add:flight3.first_fare }}
                                        {% elif stop1 == 'yes' and stop2 == 'no' %}
                                            {{ flight0.first_fare | add:flight1.first_fare | add:flight2.first_fare }}
                                        {% elif stop1 == 'no' and stop2 == 'yes' %}
                                            {{ flight3.first_fare | add:flight1.first_fare | add:flight2.first_fare }}
                                        {% else %}
                                            {{ flight1.first_fare | add:flight2.first_fare }}
                                        {% endif %}
                                    {% endif %}
                                ">
                            {% elif seat == 'Business' %}
                                $ <span>
                                    {% if tripType == '1' %}
                                        {% if stop == 'yes' %}
                                            {{ flight0.business_fare | add:flight1.business_fare }}
                                        {% else %}
                                            {{ flight1.business_fare }}
                                        {% endif %}
                                    {% else %}
                                        {% if stop1 == 'yes' and stop2 == 'yes' %}
                                            {{ flight0.business_fare | add:flight1.business_fare | add:flight2.business_fare | add:flight3.business_fare }}
                                        {% elif stop1 == 'yes' and stop2 == 'no' %}
                                            {{ flight0.business_fare | add:flight1.business_fare | add:flight2.business_fare }}
                                        {% elif stop1 == 'no' and stop2 == 'yes' %}
                                            {{ flight3.business_fare | add:flight1.business_fare | add:flight2.business_fare }}
                                        {% else %}
                                            {{ flight1.business_fare | add:flight2.business_fare }}
                                        {% endif %}
                                    {% endif %}
                                </span>
                                <input type="hidden" id="basefare" value="
                                    {% if tripType == '1' %}
                                        {% if stop == 'yes' %}
                                            {{ flight0.business_fare | add:flight1.business_fare }}
                                        {% else %}
                                            {{ flight1.business_fare }}
                                        {% endif %}
                                    {% else %}
                                        {% if stop1 == 'yes' and stop2 == 'yes' %}
                                            {{ flight0.business_fare | add:flight1.business_fare | add:flight2.business_fare | add:flight3.business_fare }}
                                        {% elif stop1 == 'yes' and stop2 == 'no' %}
                                            {{ flight0.business_fare | add:flight1.business_fare | add:flight2.business_fare }}
                                        {% elif stop1 == 'no' and stop2 == 'yes' %}
                                            {{ flight3.business_fare | add:flight1.business_fare | add:flight2.business_fare }}
                                        {% else %}
                                            {{ flight1.business_fare | add:flight2.business_fare }}
                                        {% endif %}
                                    {% endif %}
                                ">
                            {% elif seat == 'Economy' %}
                                $ <span>
                                    {% if tripType == '1' %}
                                        {% if stop == 'yes' %}
                                            {{ flight0.economy_fare | add:flight1.economy_fare }}
                                        {% else %}
                                            {{ flight1.economy_fare }}
                                        {% endif %}
                                    {% else %}
                                        {% if stop1 == 'yes' and stop2 == 'yes' %}
                                            {{ flight0.economy_fare | add:flight1.economy_fare | add:flight2.economy_fare | add:flight3.economy_fare }}
                                        {% elif stop1 == 'yes' and stop2 == 'no' %}
                                            {{ flight0.economy_fare | add:flight1.economy_fare | add:flight2.economy_fare }}
                                        {% elif stop1 == 'no' and stop2 == 'yes' %}
                                            {{ flight3.economy_fare | add:flight1.economy_fare | add:flight2.economy_fare }}
                                        {% else %}
                                            {{ flight1.economy_fare | add:flight2.economy_fare }}
                                        {% endif %}
                                    {% endif %}
                                </span>
                                <input type="hidden" id="basefare" value="
                                    {% if tripType == '1' %}
                                        {% if stop == 'yes' %}
                                            {{ flight0.economy_fare | add:flight1.economy_fare }}
                                        {% else %}
                                            {{ flight1.economy_fare }}
                                        {% endif %}
                                    {% else %}
                                        {% if stop1 == 'yes' and stop2 == 'yes' %}
                                            {{ flight0.economy_fare | add:flight1.economy_fare | add:flight2.economy_fare | add:flight3.economy_fare }}
                                        {% elif stop1 == 'yes' and stop2 == 'no' %}
                                            {{ flight0.economy_fare | add:flight1.economy_fare | add:flight2.economy_fare }}
                                        {% elif stop1 == 'no' and stop2 == 'yes' %}
                                            {{ flight3.economy_fare | add:flight1.economy_fare | add:flight2.economy_fare }}
                                        {% else %}
                                            {{ flight1.economy_fare | add:flight2.economy_fare }}
                                        {% endif %}
                                    {% endif %}
                                ">
                            {% endif %}

                            </div>
                        </div>
                        <div class="row surcharges">
                            <div class="surcharges-label">Fee & Surcharges: </div>
                            <div class="surcharges-value">$ <span>{{fee}}</span></div>
                            <input type="hidden" id="fee" value="{{fee}}">
                        </div>
                        <div class="row surcharges" id="seatSelected">

                        </div>
                        <div class="row surcharges" id="seatSelected1">

                        </div>
                        <input type="hidden" id="chosenCount" name="seat_amount" value="0">
                        <input type="hidden" id="chosenCount1" name="seat_amount1" value="0">
                        <hr>
                        <div class="total-fare">
                            <div class="total-fare-label">Total Fare: </div>
                            <div class="total-fare-value">
                                {% if seat == 'First' %}
                                    $ <span>
                                        {% if tripType == '1' %}
                                            {% if stop == 'yes' %}
                                                {{ flight0.first_fare | add:flight1.first_fare | add:fee }}
                                            {% else %}
                                                {{ flight1.first_fare | add:fee }}
                                            {% endif %}
                                        {% elif tripType == '2' %}
                                            {% if stop1 == 'yes' and stop2 == 'yes' %}
                                                {{ flight0.first_fare | add:flight1.first_fare | add:flight2.first_fare | add:flight3.first_fare | add:fee }}
                                            {% elif stop1 == 'yes' and stop2 == 'no' %}
                                                {{ flight0.first_fare | add:flight1.first_fare | add:flight2.first_fare | add:fee }}
                                            {% elif stop1 == 'no' and stop2 == 'yes' %}
                                                {{ flight3.first_fare | add:flight1.first_fare | add:flight2.first_fare | add:fee }}
                                            {% else %}
                                                {{ flight1.first_fare | add:flight2.first_fare | add:fee }}
                                            {% endif %}
                                        {% endif %}
                                    </span>
                                {% elif seat == 'Business' %}
                                    $ <span>
                                        {% if tripType == '1' %}
                                            {% if stop == 'yes' %}
                                                {{ flight0.business_fare | add:flight1.business_fare | add:fee }}
                                            {% else %}
                                                {{ flight1.business_fare | add:fee }}
                                            {% endif %}
                                        {% elif tripType == '2' %}
                                            {% if stop1 == 'yes' and stop2 == 'yes' %}
                                                {{ flight0.business_fare | add:flight1.business_fare | add:flight2.business_fare | add:flight3.business_fare | add:fee }}
                                            {% elif stop1 == 'yes' and stop2 == 'no' %}
                                                {{ flight0.business_fare | add:flight1.business_fare | add:flight2.business_fare | add:fee }}
                                            {% elif stop1 == 'no' and stop2 == 'yes' %}
                                                {{ flight3.business_fare | add:flight1.business_fare | add:flight2.business_fare | add:fee }}
                                            {% else %}
                                                {{ flight1.business_fare | add:flight2.business_fare | add:fee }}
                                            {% endif %}
                                        {% endif %}
                                    </span>
                                {% elif seat == 'Economy' %}
                                    $ <span>
                                        {% if tripType == '1' %}
                                            {% if stop == 'yes' %}
                                                {{ flight0.economy_fare | add:flight1.economy_fare | add:fee }}
                                            {% else %}
                                                {{ flight1.economy_fare | add:fee }}
                                            {% endif %}
                                        {% elif tripType == '2' %}
                                            {% if stop1 == 'yes' and stop2 == 'yes' %}
                                                {{ flight0.economy_fare | add:flight1.economy_fare | add:flight2.economy_fare | add:flight3.economy_fare | add:fee }}
                                            {% elif stop1 == 'yes' and stop2 == 'no' %}
                                                {{ flight0.economy_fare | add:flight1.economy_fare | add:flight2.economy_fare | add:fee }}
                                            {% elif stop1 == 'no' and stop2 == 'yes' %}
                                                {{ flight3.economy_fare | add:flight1.economy_fare | add:flight2.economy_fare | add:fee }}
                                            {% else %}
                                                {{ flight1.economy_fare | add:flight2.economy_fare | add:fee }}
                                            {% endif %}
                                        {% endif %}
                                    </span>
                                {% endif %}
                            </div>

                        </div>
                    </div>
                    <div class="coupon-code">
                        <h5>Have a coupon code?</h5>
                        <hr>
                        <div class="row base-fare">
                            <div class="col-9" style="padding: 10px 10px 10px 0px">
                                <input type="text" name="coupon" class="form-control" placeholder="Coupon Code" style="text-transform: uppercase;">
                            </div>
                            <div class="col coupon-apply" style="padding: 10px 10px 10px 0px">
                                <center>
                                   <button type="button" class="btn btn-primary btn-danger" id="applyCoupon" name="useCoupon" value="executeCoupon" onclick="discount()">Apply</button>
                                </center>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col media-payment-btn">
                    <div>
                        <button type="submit" class="btn btn-primary btn-danger" name="payment" value="executePayment">Proceed to payment</button>
                    </div>
                </div>
            </div>
        </form>
    </section>
<style>
    .notification {
    color: red;
    font-weight: bold;
    margin-right: 10px; /* Align to the left side of the footer */
    display: inline-block; /* Make it stay on the same line */
}
.seat {
  width: 40px;
  height: 40px;
  background-color: #DC4C64; /* Default color for available seat */
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 2px;
  cursor: pointer;
  transition: background-color 0.2s;
}

/* Style for selected seat (after choosing) */
.seat.selected {
  background-color: #a9d1d9; /* Color for selected seat (chosen and reserved) */
  cursor: not-allowed;
}

/* Style for chosen seat (before confirming selection) */
.seat.choose {
  background-color: #fdeec3; /* Color for currently choosing */
}
.seat1 {
  width: 40px;
  height: 40px;
  background-color: #DC4C64; /* Default color for available seat */
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 2px;
  cursor: pointer;
  transition: background-color 0.2s;
}

/* Style for selected seat (after choosing) for return trip */
.seat1.selected {
  background-color: #a9d1d9; /* Color for selected seat (chosen and reserved) for return trip */
  cursor: not-allowed;
}

/* Style for chosen seat (before confirming selection) for return trip */
.seat1.choose {
  background-color: #fdeec3; /* Color for currently choosing (return trip) */
}

/* Layout for area grid of seats */
.area {
  display: grid;
  grid-template-columns: repeat(5, auto);
  gap: 5px;
  justify-content: center;
}

/* Title for each seat area */
.area-title {
  text-align: center;
  margin-bottom: 10px;
  font-weight: bold;
}

/* Gap between rows */
.row-gap {
  margin-top: 20px;
}

/* Styling the legend for seat status */
.legend {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 20px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.legend-item .seat {
  width: 20px;
  height: 20px;
}
.legend-item .seat1 {
  width: 20px;
  height: 20px;
}
</style>
<script>
    let selectedCount = 0;
    let amount_seat = 0;
    let previousSelectedSeats = [];  // Mng lu tr cc gh  chn trc 

    // Add click event to all seats
    document.querySelectorAll('.seat').forEach(seat => {
        seat.addEventListener('click', () => {
            let seatValue = parseInt(seat.getAttribute('value'));
            const seatId = seat.nextElementSibling.value;
            const seatPrice = trip(parseFloat(seat.getAttribute('value')));
            console.log(seatPrice);
            // Cp nht trng thi gh
            if (!seat.classList.contains('selected')) {
                if (!seat.classList.contains('choose')) {
                    seat.classList.add('choose'); // Thm lp 'choose' nu gh c chn
                    selectedCount += seatValue;
                    amount_seat += 1;
                } else {
                    seat.classList.remove('choose'); // Loi b lp 'choose' nu gh b b chn
                    selectedCount -= seatValue;
                    amount_seat -= 1;
                }

                // Cp nht thng bo gh  chn v tng tin
                document.getElementById('count').textContent = selectedCount;
                document.getElementById('chosenCount').value = amount_seat;

                // Cp nht input hidden cho gh c chn
                const seatSelectedContainer = document.getElementById('seatSelected');
                if (seat.classList.contains('choose')) {
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = `selectedSeat_${seatId}`;
                    hiddenInput.value = seatId;
                    seatSelectedContainer.appendChild(hiddenInput);
                } else {
                    // Loi b input hidden nu gh b b chn
                    const hiddenInput = seatSelectedContainer.querySelector(`input[value='${seatId}']`);
                    if (hiddenInput) {
                        seatSelectedContainer.removeChild(hiddenInput);
                    }
                }

                // Cp nht li tng tin
                updateTotalFare();
            }
        });
    });

    function updateTotalFare() {
        const seatSelectedContainer = document.getElementById('seatSelected');
        let totalFareContainer = document.querySelector('.total-fare-value span');

        // Ly gi tr tng tin hin ti t giao din
        let totalFare = 0;
        let currentSelectedSeats = []; // Mng lu tr cc gh hin ti c chn

        seatSelectedContainer.innerHTML = ''; // Clear existing content

        // Add the "Seat & Surcharges:" label
        let surchargeLabelDiv = document.createElement('div');
        surchargeLabelDiv.classList.add('surcharges-label');
        surchargeLabelDiv.textContent = 'Seat & Surcharges:';
        seatSelectedContainer.appendChild(surchargeLabelDiv);

        let countSeat = 1;
        // Loop through all selected seats and add their price to totalFare
        document.querySelectorAll('.seat.choose').forEach(seat => {
            const seatId = seat.nextElementSibling.value;
            const seatName = seat.textContent;
            let seatPrice = trip(parseFloat(seat.getAttribute('value')));
            const currencySelect = document.getElementById('currency');  // Define the variable here
            const selectedCurrency = currencySelect.value;

            // Set the exchange rate based on the selected currency
            const exchangeRate = exchangeRates[selectedCurrency];

            // Apply currency conversion if necessary
            if (currencySelect.value === 'VND') {
                seatPrice *= exchangeRate; // Convert from USD to VND

            }
            function formatVND(value) {
                return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.'); // Thm du chm
            }
            // Add seat to currentSelectedSeats array
            if (!currentSelectedSeats.includes(seatId)) {
                currentSelectedSeats.push(seatId);

                // Create hidden input for selected seat
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = `selectedSeat_${countSeat}`;
                hiddenInput.value = seatId;
                seatSelectedContainer.appendChild(hiddenInput);

                // Create surcharge value div for the seat
                const surchargeValueDiv = document.createElement('div');
                surchargeValueDiv.classList.add('surcharges-value');
                surchargeValueDiv.innerHTML = `${seatName} - $<span>${(seatPrice * percentDiscount)}</span>`;
                seatSelectedContainer.appendChild(surchargeValueDiv);

                totalFare += seatPrice;
                console.log(totalFare);
                
                // Increment seat count
                countSeat++;
            }
        });

        // Define the variable here
        //  fare = document.querySelector(".base-fare-value span").textContent;
        //  feeElement = document.querySelector(".row.surcharges .surcharges-value span");

        //  currencySelect = document.getElementById('currency');  // Define the variable here
        // let fee;  // Declare fee outside the condition to make it accessible later

        // Get fare and fee elements
        let fare = document.querySelector(".base-fare-value span").textContent;
        let feeElement = document.querySelector(".row.surcharges .surcharges-value span");
        const currencySelect = document.getElementById('currency');  // Get the currency select element
        let fee;  // Declare fee variable
        let cleanedFeeText 
        if(currencySelect.value === 'VND') {

            totalFare = parseFloat(totalFare);
            console.log("oke here 1");
            console.log("1a" +totalFare);
            

        } else {
            totalFare = parseInt(totalFare);
            console.log("oke here");
            console.log("1a" +totalFare);
            
        }
        // totalFare = parseFloat(totalFare);

        // Clean up feeElement text to remove any currency symbol (e.g., )
        if(currencySelect.value === 'USD') {
         cleanedFeeText = feeElement.textContent;
    } else {
         cleanedFeeText = feeElement.textContent.replace(/[^\d.-]/g, '');

    }
        // Parse the fee according to the selected currency
        if (currencySelect.value === 'USD') {
            fee = parseInt(cleanedFeeText); // Parse fee as an integer if USD
        } else {
            fee = (cleanedFeeText.replace(/[^\d-]/g, '')); // For other currencies, you can adjust logic if needed
        }
        // Clean up and parse the fare as well (in case it has currency symbols like )
        let cleanedFare = fare;
        let parsedFare
        if(currencySelect.value === 'USD') {
         parsedFare = parseFloat(cleanedFare); // Or use parseFloat if necessary
        } else {
             parsedFare = (cleanedFare.replace(/[^\d-]/g, '')) ;
        }
        console.log('first ' + parsedFare);
        console.log('first ' + fee);

        // Initialize totalFare (you should adjust this depending on previous calculation)
        // totalFare = 0;
        console.log("Total Fare:", totalFare);
        console.log("Fare:", parsedFare);
        console.log("Fee:", fee);
        // Calculate totalFare based on selected currency
        totalFare = parseInt(totalFare);
        parsedFare = parseInt(parsedFare);
        fee = parseInt(fee);
        totalFare = (totalFare + parsedFare + fee);

       




        // Update the total fare in the UI
        const selectedCurrency = document.getElementById('currency').value; // Ly loi tin t  chn
        function formatVND(value) {
            return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.'); // Thm du chm
        }
        totalFareContainer.innerText = selectedCurrency === 'USD' ? totalFare.toFixed(1) : `${formatVND(Math.round(totalFare))}`;

        // Update the seat count
        document.getElementById('chosenCount').value = currentSelectedSeats.length;
    }

</script>
<script>
    let selectedCount1 = 0;
    let amount_seat1 = 0;
    let previousSelectedSeats1 = [];  // Array to store previously selected seats for the return flight


    // Add click event to all seats in the return flight
    document.querySelectorAll('.seat1').forEach(seat => {
        seat.addEventListener('click', () => {
            let seatValue = parseInt(seat.getAttribute('value'));
            const seatId = seat.nextElementSibling.value;
            const seatPrice = parseFloat(seat.getAttribute('value'));

            // Update the seat status for the return flight
            if (!seat.classList.contains('selected')) {
                if (!seat.classList.contains('choose')) {
                    seat.classList.add('choose'); // Add 'choose' class when the seat is selected
                    selectedCount1 += seatValue;
                    amount_seat1 += 1;
                } else {
                    seat.classList.remove('choose'); // Remove 'choose' class if the seat is deselected
                    selectedCount1 -= seatValue;
                    amount_seat1 -= 1;
                }

                // Update the notification and total amount
                document.getElementById('count1').textContent = selectedCount1;
                document.getElementById('chosenCount1').value = amount_seat1;

                // Update hidden input for selected seats in the return flight
                const seatSelectedContainer1 = document.getElementById('seatSelected1');
                if (seat.classList.contains('choose')) {
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = `selectedSeat_${seatId}`;
                    hiddenInput.value = seatId;
                    seatSelectedContainer1.appendChild(hiddenInput);
                } else {
                    // Remove the hidden input if the seat is deselected
                    const hiddenInput = seatSelectedContainer1.querySelector(`input[value='${seatId}']`);
                    if (hiddenInput) {
                        seatSelectedContainer1.removeChild(hiddenInput);
                    }
                }

                // Update the total fare for the return flight
                updateTotalFare2();
            }
        });
    });

    function updateTotalFare2() {
        const seatSelectedContainer1 = document.getElementById('seatSelected1');
        let totalFareContainer1 = document.querySelector('.total-fare-value span');

        let totalFare = 0;
        let currentSelectedSeats1 = []; // Array to store currently selected seats for the return flight

        seatSelectedContainer1.innerHTML = ''; // Clear existing content
        console.log('ok');

        // Add the "Seat & Surcharges:" label
        let surchargeLabelDiv = document.createElement('div');
        surchargeLabelDiv.classList.add('surcharges-label');
        surchargeLabelDiv.textContent = 'Seat & Surcharges (Return):';
        seatSelectedContainer1.appendChild(surchargeLabelDiv);

        // Loop through all selected seats for the return flight
        document.querySelectorAll('.seat1.choose').forEach(seat => {
            const seatId = seat.nextElementSibling.value;
            const seatName = seat.textContent;
            let seatPrice = trip(parseFloat(seat.getAttribute('value')));
            // Add seat to the currentSelectedSeats1 array
            if (!currentSelectedSeats1.includes(seatId)) {
                currentSelectedSeats1.push(seatId);

                // Create hidden input for selected seat
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = `selectedSeat1_${currentSelectedSeats1.length}`;
                hiddenInput.value = seatId;
                seatSelectedContainer1.appendChild(hiddenInput);

                // Create surcharge value div for the return flight seat
                const surchargeValueDiv1 = document.createElement('div');
                surchargeValueDiv1.classList.add('surcharges-value');
                surchargeValueDiv1.innerHTML = `${seatName} - $<span>${(seatPrice * percentDiscount).toFixed(2)}</span>`;
                seatSelectedContainer1.appendChild(surchargeValueDiv1);


                totalFare += seatPrice; // Add seat price to total fare
            }
        });

        // Update the total fare with the base fare and fee for the return flight
        let fare1 = document.querySelector(".base-fare-value1 span").textContent;
        let fee1 = document.querySelector("#fee1").value;
        totalFare = parseFloat(fare1) + parseFloat(fee1) + totalFare;

        // Update the total fare in the UI
        totalFareContainer1.innerText = totalFare.toFixed(1);

        // Update the seat count
        document.getElementById('chosenCount1').value = currentSelectedSeats1.length;
    }

    const exchangeRates = {
        USD: 1,        // Gi tr USD gc
        VND: 24000,    // T gi USD sang VND
    };

    // Hm cp nht gi tr ca gh da trn loi tin t
    function updateCurrency() {
        const selectedCurrency = document.getElementById('currency').value; // Ly loi tin t  chn
        console.log(`Loi tin t  chn: ${selectedCurrency}`);
        // Cc phn t cn chuyn i tin t
        const baseFareElement = document.getElementById('basefare');
        const feeElement = document.getElementById('fee');
        const totalFareElement = document.querySelector('.total-fare-value span');

        const baseFare = parseFloat(baseFareElement.value); // Gi tr gc ca base fare (USD)
        const fee = parseFloat(feeElement.value); // Ph hin ti
        console.log(`Gi tr base fare: ${baseFare}, Ph: ${fee}`);

        // Chuyn i tin t t USD sang tin t  chn
        const convertedBaseFare = (baseFare * exchangeRates[selectedCurrency]).toFixed(1);
        const convertedFee = (fee * exchangeRates[selectedCurrency]).toFixed(1);
        let totalFare = (baseFare + fee) * exchangeRates[selectedCurrency];
        console.log(`Base fare sau khi chuyn i: ${convertedBaseFare}, Ph sau khi chuyn i: ${convertedFee}, Tng tin sau khi chuyn i: ${totalFare}`);

        function formatVND(value) {
            return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.'); // Thm du chm
        }
        // Cp nht hin th giao din cho base fare v fee
        document.querySelector('.base-fare-value span').innerText = selectedCurrency === 'USD' ? ` ${convertedBaseFare}` : `${formatVND(Math.round(convertedBaseFare))}`;
        document.querySelector('.surcharges-value span').innerText = selectedCurrency === 'USD' ? ` ${convertedFee}` : `${formatVND(Math.round(convertedFee))}`;
        totalFareElement.innerText = selectedCurrency === 'USD' ? ` ${totalFare}` : `${formatVND(totalFare.toFixed(0))}`;

        const seatContainer = document.getElementById('seatSelected');


        // Lp qua tt c cc gh trong container
        seatContainer.querySelectorAll('.surcharges-value').forEach((surchargeDiv, index) => {
            // Ly gi tr gh v ph t span
            const seatName = surchargeDiv.textContent.split('-')[0].trim();
            const spanElement = surchargeDiv.querySelector('span'); // Ly phn t <span>
            console.log('day la span' + spanElement);
            console.log(spanElement?.textContent.replace(/[^0-9.,]/g, '') || 0);

            // Lm sch gi tr gi gh, loi b du chm v ch gi li du phy nu c
            let seatPriceStr = spanElement?.textContent.replace(/[^0-9.,]/g, ''); // Loi b k t khng phi s v du phn cch
            let seatPriceCleaned = seatPriceStr.replace(/\./g, ''); // Loi b du chm (du phn cch ngn)
            let seatPrice = parseInt(parseFloat(seatPriceCleaned.replace(',', '.')) || 0); // Chuyn thnh s, nu c du phy chuyn thnh du chm

            console.log(`Gi gh: ${seatPrice}`);
            console.log(exchangeRates);

            if (!isNaN(seatPrice)) {
                // Chuyn i tin t
                let convertedSeatPrice;

                if (selectedCurrency === 'USD') {
                    convertedSeatPrice = seatPrice / exchangeRates.VND; // T VND sang USD
                    console.log(seatPrice);
                    console.log(exchangeRates);
                    console.log(convertedSeatPrice);

                    console.log(123);

                } else {
                    convertedSeatPrice = seatPrice * exchangeRates.VND; // T USD sang VND
                    console.log(seatPrice);
                    console.log(exchangeRates);
                    console.log(convertedSeatPrice);
                    console.log(123);

                }

                console.log(`Chuyn i ${seatPrice} t ${selectedCurrency === 'USD' ? 'VND' : 'USD'} sang ${selectedCurrency === 'USD' ? 'USD' : 'VND'}: ${formatVND(convertedSeatPrice)}`);

                const formattedPrice = selectedCurrency === 'USD'
                    ? convertedSeatPrice // Hin th 2 s thp phn cho USD
                    : formatVND(Math.round(convertedSeatPrice)); // nh dng VND vi du chm v khng c s thp phn


                // Lm sch v cp nht li surchargeDiv
                surchargeDiv.innerHTML = `${seatName} - ${selectedCurrency === 'USD' ? '$' : ''}<span>${formattedPrice}</span>`;

                // Cp nht gi tr ca input hidden tng ng
                const hiddenInput = seatContainer.querySelectorAll('input[type="hidden"]')[index];
                if (hiddenInput) {
                    hiddenInput.value = formattedPrice;
                }
                console.log(123);
                totalFare += convertedSeatPrice;

            } else {
                console.warn(`Khng th chuyn i gi tr tin t ti: ${seatName}`);
            }
        });

        totalFareElement.innerText = selectedCurrency === 'USD' ? ` ${totalFare}` : `${formatVND(totalFare.toFixed(0))}`;


        document.querySelectorAll('.fare-summary .value').forEach(valueDiv => {
            let fareValue = parseFloat(valueDiv.textContent.replace(/[^0-9.-]/g, '') || 0);
            console.log(`Gi tr fare: ${fareValue}`);

            if (!isNaN(fareValue)) {
                // Chuyn i gi tr
                const convertedFare =
                    selectedCurrency === 'USD'
                        ? fareValue / exchangeRates.VND
                        : fareValue * exchangeRates.VND;
                console.log(`Gi tr fare sau khi chuyn i: ${convertedFare}`);

                // nh dng gi tr
                const formattedFare =
                    selectedCurrency === 'USD'
                        ? convertedFare.toFixed(1) // Hin th 2 s thp phn cho USD
                        : formatVND(Math.round(convertedFare)); // nh dng VND vi du chm v khng c s thp phn
                console.log(`Gi tr fare sau khi chuyn i: ${formattedFare}`);

                // Cp nht ni dung
                valueDiv.textContent = `${selectedCurrency === 'USD' ? '' : ''}${formattedFare}`;
            }
        });
    }
    </script>
{% endblock %}